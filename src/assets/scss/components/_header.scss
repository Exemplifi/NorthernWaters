// Header Component
@import "../utils/rem-convert";

.header {
  z-index: 4;
  position: fixed;
  top: rem.convert(32px);
  left: 0;
  right: 0;
  background-color: var(--white);
  border-radius: rem.convert(16px);
  max-width: rem.convert(1280px);
  margin: 0 auto;
  display: flex;
  justify-content: center;
  align-items: center;
  transition: all 0.5s ease;
  transform: translateY(0);
  box-shadow: 0 8px 16px rgba(0, 0, 0, 0.1);
  &.less-spacing-top {
    top: rem.convert(24px);
    @include media-breakpoint-down(lg) {
      top: 0;
    }
  }
  @include media-breakpoint-up(lg) {
    padding: 0;
  }
  @include media-breakpoint-down(lg) {
    position: relative;
    max-width: rem.convert(100%);
    top: 0;
    right: 0;
    left: 0;
    border-radius: 0;
    padding: 0;
    width: 100%;
    max-width: 100%;
    margin: 0;
  }
  &.upwards {
    position: fixed;
  }
  &.downwards {
    position: absolute;
    top: -100%;
    left: 24px;
    right: 24px;
    width: calc(100% - 48px);
    max-width: rem.convert(1280px);
    transform: translateY(0);
    animation: headerSlideUp 0.5s ease-out;
    border-radius: rem.convert(16px);
  }
  // Navbar Base Styles
  .navbar {
    padding: rem.convert(16px) rem.convert(12px);
    min-height: rem.convert(52px);
    @include media-breakpoint-down(lg) {
      min-height: rem.convert(64px);
      padding: 1rem;
    }
    .navbar-collapse {
      @include media-breakpoint-down(lg) {
      
      &.show {
        left: 0;
      }
      }
    }
  }

  // Logo
  &__logo {
    display: block;
    width: rem.convert(140px);
    height: rem.convert(45px);
    &:focus,
    &:focus-visible {
      box-shadow: none;
      outline: 1px solid var(--black-2);
      outline-offset: rem.convert(2px);
    }
    img {
      width: 100%;
      height: 100%;
      object-fit: contain;
    }
    @include media-breakpoint-down(lg) {
      width: rem.convert(100px);
      height: auto;
    }
  }

  // Navigation
  &__navigation {
    @include media-breakpoint-up(lg) {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-left: auto;
    }
  }

  // Menu
  &__menu {
    @include media-breakpoint-up(lg) {
      display: flex;
      margin: 0 auto;
    }
  }

  // Menu Item
  &__menu-item {
    position: relative;
    &.active{
      .header__menu-link{
        color: rgba(var(--black-rgb), 0.8) !important;
        background-color: rgba(var(--green-rgb), 0.2);
        svg{
          transform: rotate(180deg);
        }
        @include media-breakpoint-down(lg){
          color: var(--black) !important;
          background-color: transparent;
        }
      }
    }
  }

  // Menu Link
  &__menu-link {
    display: flex !important;
    align-items: center;
    border-radius: rem.convert(50px);
    @include rem.convert(column-gap, 8px);
    font-family: var(--body-font-family);
    font-weight: $semibold;
    @include rem.convert(font-size, 16px);
    line-height: 1.2;
    color: var(--black) !important;
    @include rem.convert(padding, 8px 0);

    @include media-breakpoint-up(lg) {
      @include rem.convert(padding, 12px 24px !important);
    }
    @include media-breakpoint-down(lg) {
      justify-content: space-between;
      padding: 1rem 0;
      font-family: var(--heading-font-family);
      font-weight: 700;
      @include rem.convert(font-size, 18px);
      line-height: 1.5;
      letter-spacing: 0;
      text-transform: capitalize;
      border-bottom: 1px solid #11111199;
      border-radius: 0;
      &.dropdown{
        overflow: hidden;
      }
    }

    &:hover,
    &:focus {
      color: rgba(var(--black-rgb), 0.8) !important;
      background-color: rgba(var(--green-rgb), 0.2);
      @include media-breakpoint-down(lg){
        color: var(--black) !important;
        background-color: transparent;
      }
    }

    // AAA Compliant Focus Indicators
    &:focus-visible {
      outline: 3px solid var(--green);
      outline-offset: 2px;
      box-shadow: 0 0 0 1px var(--white);
    }

    // Remove Bootstrap's default dropdown arrow
    &.dropdown-toggle::after {
      display: none;
    }
  }

  // Menu Icon (chevron)
  &__menu-icon {
    // @include rem.convert((width, height), 12px, 6px);
    width: rem.convert(24px);
    height: rem.convert(18px);
    transition: transform 0.3s ease;
    @include media-breakpoint-down(lg){
      width: rem.convert(24px);
      height: rem.convert(24px);
    }

    &.rotated {
      transform: rotate(180deg);
    }

    .show > .nav-link & {
      transform: rotate(180deg);
    }
  }

  // Submenu
  &__submenu {
    background-color: rgba($white, 0.8);
    border: none;
    @include rem.convert(border-radius, 8px);
    @include rem.convert(padding, 8px 0);
    @include rem.convert(min-width, 200px);
    text-align: center;

    @include media-breakpoint-down(lg) {
      border-radius: 0;
      box-shadow: none;
      background-color: rgba($white, 0.1);
    }
  }

  // Submenu Link
  &__submenu-link {
    font-family: "Sculpin", "Segoe UI", Arial, sans-serif;
    font-weight: 400;
    @include rem.convert(font-size, 14px);
    line-height: 1.2;
    color: var(--black);
    @include rem.convert(padding, 8px 16px);

    &:hover,
    &:focus {
      background-color: rgba($white, 0.1);
      color: var(--black);
    }
  }

  // Actions Container
  &__actions {
    display: flex;
    align-items: center;
    @include rem.convert(gap, 24px);
    @include rem.convert(margin-top, 16px);

    @include media-breakpoint-up(lg) {
      margin-top: 0;
    }
    @include media-breakpoint-down(lg) {
      justify-content: space-between;
      align-items: center;
      flex-direction: column;
    }
  }

  // Search Button
  &__search-btn {
    background: none;
    border: none;
    padding: 0;
    @include rem.convert((width, height), 28px, 28px);
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    transition: opacity 0.2s ease;
    @include media-breakpoint-down(lg){
      display: none;
    }

    &:hover,
    &:focus {
      opacity: 0.8;
    }

    img {
      @include rem.convert((width, height), 18.67px, 18.67px);
    }
  }

  // Login Button
  &__login-btn {
    display: flex;
    align-items: center;
    background-color: var(--green);
    @include rem.convert(border-radius, 40px);
    @include rem.convert(padding, 12px 24px);
    font-family: "Sculpin", "Segoe UI", Arial, sans-serif;
    font-weight: 600;
    @include rem.convert(font-size, 16px);
    line-height: 1.2;
    color: $black;
    text-decoration: none;
    transition: background-color 0.2s ease;

    &:hover,
    &:focus {
      background-color: darken($white, 5%);
    }

    img {
      @include rem.convert((width, height), 16px, 16px);
    }
  }

  // Mobile Toggle Button
  &__toggle {
    padding: 0;
    border: none;
    width: fit-content;
    height: auto;
    transition: all 0.3s ease;
    display: flex;
    justify-content: center;
    align-items: center;
    column-gap: rem.convert(16px);
    &:focus,
    &:focus-visible {
      box-shadow: none;
      outline: 1px solid var(--black-2);
      outline-offset: rem.convert(2px);
    }

    @include media-breakpoint-up(lg) {
      display: none;
    }

    .navbar-toggler-icon {
      background-image: url("data:image/svg+xml,%3Csvg width='24' height='24' viewBox='0 0 24 24' fill='none' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M3 12H21M3 6H21M3 18H21' stroke='black' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'/%3E%3C/svg%3E");
      transition: background-image 0.3s ease;
      @include media-breakpoint-down(lg){
        width: rem.convert(24px);
        height: rem.convert(24px);
      }
    }
    .navbar-toggler-label {
      font-family: var(--body-font-family);
      font-weight: 600;
      font-size: rem.convert(16px);
      line-height: 150%;
      color: var(--black-2);
    }

    &[aria-expanded="true"] {
      .navbar-toggler-icon {
        background-image: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" width="24" height="25" viewBox="0 0 24 25" fill="none"><path d="M18 6.07141L6 18.0714" stroke="%23111111" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/><path d="M6 6.07141L18 18.0714" stroke="%23111111" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg>');
      }
    }
  }

  // Responsive Styles
  @include media-breakpoint-down(lg) {
    .navbar-collapse {
      position: fixed;
      top: 100%; // Start below viewport
      left: 0; // Keep left position constant - no horizontal movement
      right: 0;
      bottom: 0;
      background-color: var(--white);
      @include rem.convert(padding, 32px 16px);
      overflow-y: auto;
      overflow-x: hidden;
      transition: transform 0.3s cubic-bezier(0.25, 0.8, 0.25, 1); // Smooth easing
      transform: translateX(100%); // Initial position (hidden below)
      height: 100vh; // Fixed height prevents content jumps
      width: 100vw;
      z-index: 9999;
      
      // Performance optimization for smooth animations
      will-change: transform;
      backface-visibility: hidden;
      
      // Smooth slide up animation
      &.show {
        transform: translateX(0); // Slide up to show
      }
      
      // AAA: Scrollbar styling for mobile
      &::-webkit-scrollbar {
        width: rem.convert(6px);
      }
      
      &::-webkit-scrollbar-track {
        background: rgba(var(--black-rgb), 0.1);
      }
      
      &::-webkit-scrollbar-thumb {
        background: rgba(var(--black-rgb), 0.3);
        border-radius: rem.convert(3px);
      }
    }
  }
  // Mega Menu Styles - Enhanced Version
@include media-breakpoint-up(lg){
  .header__search-input-container{
    display: none;
  }
  .has-mega-menu {
    position: static;
  }
  .mega-menu-wrapper {
    display: none;
    position: absolute;
    top: calc(100% - 2rem);
    left: 0;
    background-color: transparent;
    z-index: 4;
    width: 100%;
    max-width: rem.convert(1280px);
    margin: 0 auto;
    padding-top: 2.5rem;
    &.show {
      display: block;
      .mega-menu-inner{
        animation: slideInFromTop 0.3s ease-out;
      }
    }
    .mega-menu-inner {
      background-color: var(--white);
      box-shadow: 0px 8px 24px 0px #1111111A;
      border-radius: rem.convert(16px);
      display: flex;
      flex-direction: column;
      min-height: 300px;
      height: 100%;
      flex: 1;
      position: relative;
      overflow: visible; // Ensure level 3 and 4 menus aren't clipped
      .label-wrapper {
        padding: 1.5rem 2rem;
        display: flex;
        gap: 0.5rem;
        border-bottom: 1px solid #11111199;
        flex-shrink: 0;
      }
      .mega-menu {
        position: relative;
        flex: 1;
        display: flex;
        flex-direction: row;
        width: 100%;
        overflow: visible; // Ensure level 3 and 4 menus aren't clipped
        .level-2-menu {
          width: 33.33%;
          padding: 1.25rem 1.75rem;
          border-right: 1px solid #11111199;
          flex-shrink: 0;
          display: flex;
          flex-direction: column;
          min-height: 100%;
          box-sizing: border-box;
          position: relative;
          overflow: visible; // Ensure child menus aren't clipped
          .level-2-menu-container{
            display: flex;
            flex-direction: column;
            gap: 0.25rem;
            padding-top: 0.25rem;
            padding-bottom: 0.25rem;
            padding-left: 0.25rem;
            > li {
              list-style: none;
              overflow: visible; 
              &.menu-cover-image{
                position: absolute;
                left: 100%;
                top: 0;
                width: 100%;
                padding: 1.5rem 2rem;
                > a{
                  img{
                    width: 100%;
                    border-radius: rem.convert(12px);
                  }
                  &:hover{
                    background: transparent;
                  }
                }
              }
              &.has-level-3-children {
                cursor: pointer;
                &.active{
                  & ~ .menu-cover-image{
                    display: none;
                  }
                  > .level-3-menu{
                    .level-3-menu-container{
                      > li{
                        > a{
                          transform: translateX(0);
                          opacity: 1;
                        }
                    }}
                  }
                }
                > .level-3-menu {
                  position: absolute;
                  top: 0;
                  left: 100%;
                  width: 100%;
                  min-width: 200px;
                  background: var(--white);
                  border-left: 1px solid #11111199;
                  z-index: 5;
                  display: none;
                  flex-direction: column;
                  min-height: 250px;
                  height: 100%;
                  padding: 1.25rem 1.75rem;
                  overflow: visible; // Ensure level 4 menus aren't clipped
                  .level-3-menu-container{
                    padding-top: 0.25rem ;
                    padding-bottom: 0.25rem;
                    padding-left: 0.25rem;
                    display: flex;
                    flex-direction: column;
                    gap: 0.25rem;
                   > li{
                      list-style: none;
                      > a{
                        transform: translateX(-15%);
                        overflow-x: hidden;
                        transition: all 0.3s ease-in-out;
                        opacity: 0;
                      }
                      &.has-level-4-children {
                        cursor: pointer;
                        overflow: visible; 
                        &.active{
                          > .level-4-menu{
                            .level-4-menu-container{
                              > li{
                                > a{
                                  transform: translateX(0);
                                  opacity: 1;
                                }
                              }
                            }
                          }
                        }
                        > .level-4-menu {
                          position: absolute;
                          top: 0;
                          left: 100%;
                          width: 100%;
                          max-width: rem.convert(432px);
                          background: var(--white);
                          border-left: 1px solid #11111199;
                          z-index: 6;
                          display: none;
                          flex-direction: column;
                          min-height: 250px;
                          height: 100%;
                          padding: 1.25rem 1.75rem;
                          .level-4-menu-container{
                            padding-top: 0.25rem ;
                            padding-bottom: 0.25rem;
                            padding-left: 0.25rem;
                            display: flex;
                            flex-direction: column;
                            gap: 0.25rem;
                            > li{
                              list-style: none;
                              > a{
                                transform: translateX(-15%);
                                overflow-x: hidden;
                                transition: all 0.3s ease-in-out;
                                opacity: 0;
                              }
                            }
                          }
                        }
                        &:hover > .level-4-menu,
                        &.active > .level-4-menu {
                          display: flex;
                        }
                      }
                    }
                  }
                }
                &:hover > .level-3-menu,
                &.active > .level-3-menu {
                  display: flex;
                }
              }
            }
          }
        }
        li{
          &.has-level-3-children{
           > a{
              position: relative;
              padding-right: 3.5rem;
              &::after {
                content: '';
                display: inline-block;
                vertical-align: middle;
                width: 32px;
                height: 32px;
                background: url('../images/arrow-right-black.svg') no-repeat center center/16px 16px;
                transition: all 0.3s ease;
                position: absolute;
                top: 50%;
                right: 24px;
                transform: translateY(-50%);
                border-radius: 50%;
              }
            }
            &.active{
              >a{
                background: var(--green);
                color: var(--white);
                padding-right: 3rem;
                &::after{
                  right: 1rem;
                  background: white url("../images/arrow-right-black.svg") no-repeat center center/16px 16px;
                }
              }
            }
          }
          &.has-level-4-children{
            > a{
              position: relative;
              padding-right: 3.5rem;
              &::after {
                content: '';
                display: inline-block;
                vertical-align: middle;
                width: 32px;
                height: 32px;
                background: url('../images/arrow-right-black.svg') no-repeat center center/16px 16px;
                transition: all 0.3s ease;
                position: absolute;
                top: 50%;
                right: 24px;
                transform: translateY(-50%);
                border-radius: 50%;
              }
            }
            &.active{
             > a{
                background: var(--green);
                color: var(--white);
                padding-right: 3rem;
                &::after{
                  right: 1rem;
                  background: white url("../images/arrow-right-black.svg") no-repeat center center/16px 16px;
                }
              }
            }
          }
          > a{
            color: var(--black);
            padding: 1rem 1.5rem;
            display: block;
            border-radius: rem.convert(12px);
            transition: all 0.3s ease;
            background: transparent;
            text-decoration: none;
            font-weight: 600;
            font-size: 1rem;
            line-height: 1.5;
            letter-spacing: 0;
            
            &:hover{
              background: var(--green);
              color: var(--white);
            }
            
            // AAA Compliant Focus Indicators for Mega Menu Items
            &:focus,
            &:focus-visible {
              outline: 3px solid var(--green);
              outline-offset: 2px;
              box-shadow: 0 0 0 1px var(--white);
              background: rgba(var(--green-rgb), 0.1);
              color: var(--green);
            }
          }
          &.has-image-link{
            > a{
              padding: 0;
              margin-top: 1.5rem;
              img{
                width: 100%;
                height: auto;
                object-fit: cover;
                border-radius: rem.convert(12px);
              }
            }
          }
        }
        // Scroll class for tall menu columns
        .mega-menu-scroll {
          padding-right: 0 !important;
          > ul{
            overflow-y: auto;
            overflow-x: hidden;
            height: 100%;
            margin-right: 0.75rem;
            padding-right: 1rem;
          }
        }
      }
    }
    .level-2-menu-container::-webkit-scrollbar-track, .level-3-menu-container::-webkit-scrollbar-track, .level-4-menu-container::-webkit-scrollbar-track
  {
    border-radius: 100px;
    background-color: #1111111A;
  }
  .level-2-menu-container::-webkit-scrollbar, .level-3-menu-container::-webkit-scrollbar, .level-4-menu-container::-webkit-scrollbar
  {
    width: 8px;
    background-color: #1111111A;
  }
  
  .level-2-menu-container::-webkit-scrollbar-thumb, .level-3-menu-container::-webkit-scrollbar-thumb, .level-4-menu-container::-webkit-scrollbar-thumb
  {
    border-radius: 100px;
    background-color: #585858;
  }
  }
}
@include media-breakpoint-down(lg){
       .header__search-input-container{
     .header__search-input-wrapper{
       position: relative;
       display: flex;
       align-items: center;
       border: 1px solid #11111199;
       border-radius: 0.5rem;
       overflow: hidden;
       margin-bottom: 2rem;
       &:focus-within{
         border: 1px solid var(--green);
         box-shadow: 0 0 0 3px rgba(var(--green-rgb), 0.1);
       }
       input{
         flex: 1;
         padding: rem.convert(12px) 1rem;
         color: var(--black);
         border: none;
         outline: none;
         background: transparent;
         &:focus{
           border: none;
           outline: none;
         }
         &::placeholder{
           color: rgba(var(--black-rgb), 0.4);
         }
       }
       .header__search-submit-btn {
         background: none;
         border: none;
         padding: rem.convert(8px) 1rem;
         cursor: pointer;
         display: flex;
         align-items: center;
         justify-content: center;
         transition: background-color 0.2s ease;
         
         &:hover,
         &:focus {
           background-color: rgba(var(--green-rgb), 0.15);
           outline: none;
         }
         
         &:focus-visible {
           outline: 3px solid var(--green);
           outline-offset: 2px;
         }
         
         // AAA: Touch feedback
         &:active {
           transform: scale(0.95);
           background-color: rgba(var(--green-rgb), 0.25);
         }
         
         .header__search-input-icon {
           width: rem.convert(24px);
           height: rem.convert(24px);
           color: var(--black);
           flex-shrink: 0;
           stroke-width: 2;
         }
       }
     }
    
   }
   .nav-item.dropdown.has-mega-menu.active .mega-menu-wrapper {
    max-height: 2000px;
    opacity: 1;
    transform: scaleY(1);
    
    .level-2-menu-container > li {
      opacity: 1;
      transform: translateY(0);
    }
  }
  .mega-menu-wrapper{
    max-height: 0;
    opacity: 0;
    overflow: hidden;
    transform: scaleY(0);
    transform-origin: top;
    transition: max-height 0.4s ease-in-out, opacity 0.3s ease-in-out, transform 0.3s ease-in-out;   
    a{
      font-family: var(--body-font-family);
      font-weight: 600;
      font-size: 1rem;
      line-height: 1.5;
      letter-spacing: 0;
      color: var(--black);
      text-decoration: none;
      display: block;
    }
    .label-wrapper{
      display: none;
    }
    .level-2-menu{
      .level-2-menu-container{
        padding: 0;
        list-style: none;
        > li{
          opacity: 0;
          transform: translateY(-10px);
          transition: opacity 0.3s ease-in-out, transform 0.3s ease-in-out;
          
          // Stagger animation for each item
          @for $i from 1 through 10 {
            &:nth-child(#{$i}) {
              transition-delay: #{$i * 0.05}s;
            }
          }
          
          > a{
            padding: 1rem;
          }
          &.has-level-3-children{
            >a{
              position: relative;
              padding-right: 2.5rem;
              &::after{
                content: '';
                width: rem.convert(24px);
                height: rem.convert(24px);
                background: url('data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2225%22%20viewBox%3D%220%200%2024%2025%22%20fill%3D%22none%22%3E%0A%3Cpath%20d%3D%22M12.0041%2016.143C11.8725%2016.1438%2011.742%2016.1185%2011.6202%2016.0688C11.4983%2016.019%2011.3875%2015.9457%2011.2941%2015.853L5.29409%209.85301C5.10579%209.6647%205%209.40931%205%209.14301C5%208.87671%205.10579%208.62131%205.29409%208.43301C5.4824%208.2447%205.73779%208.13892%206.00409%208.13892C6.27039%208.13892%206.52579%208.2447%206.71409%208.43301L12.0041%2013.733L17.2941%208.44301C17.4854%208.27918%2017.7315%208.19358%2017.9831%208.2033C18.2348%208.21302%2018.4736%208.31735%2018.6517%208.49544C18.8297%208.67354%2018.9341%208.91228%2018.9438%209.16395C18.9535%209.41563%2018.8679%209.66171%2018.7041%209.85301L12.7041%2015.853C12.5178%2016.0378%2012.2664%2016.1419%2012.0041%2016.143Z%22%20fill%3D%22%23111111%22/%3E%0A%3C/svg%3E');
                position: absolute;
                top: 50%;
                right: 1rem;
                transform: translateY(-50%);
                transition: transform 0.3s ease;
              }
            }
            &.active {
              > a{
                border-bottom: 2px solid #11111199;
                &::after {
                  transform: translateY(-50%) rotate(180deg);
                }
              }
              .level-3-menu {
                max-height: 1000px;
                opacity: 1;
                transform: scaleY(1);
                
                .level-3-menu-container > li {
                  opacity: 1;
                  transform: translateY(0);
                }
              }
            }
            .level-3-menu{
              max-height: 0;
              opacity: 0;
              overflow: hidden;
              transform: scaleY(0);
              transform-origin: top;
              transition: max-height 0.4s ease-in-out, opacity 0.3s ease-in-out, transform 0.3s ease-in-out;
                              .level-3-menu-container{
                  padding: 0;
                  list-style: none;
                  > li{
                    opacity: 0;
                    transform: translateY(-10px);
                    transition: opacity 0.3s ease-in-out, transform 0.3s ease-in-out;
                    
                    // Stagger animation for each item
                    @for $i from 1 through 10 {
                      &:nth-child(#{$i}) {
                        transition-delay: #{$i * 0.05}s;
                      }
                    }
                    
                    >a{
                      padding: 1rem 1.5rem;
                    }
                  &.has-level-4-children{
                    >a{
                      position: relative;
                      padding-right: 3rem;
                      &::after{
                        content: '';
                        width: rem.convert(24px);
                        height: rem.convert(24px);
                        background: url('data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2225%22%20viewBox%3D%220%200%2024%2025%22%20fill%3D%22none%22%3E%0A%3Cpath%20d%3D%22M12.0041%2016.143C11.8725%2016.1438%2011.742%2016.1185%2011.6202%2016.0688C11.4983%2016.019%2011.3875%2015.9457%2011.2941%2015.853L5.29409%209.85301C5.10579%209.6647%205%209.40931%205%209.14301C5%208.87671%205.10579%208.62131%205.29409%208.43301C5.4824%208.2447%205.73779%208.13892%206.00409%208.13892C6.27039%208.13892%206.52579%208.2447%206.71409%208.43301L12.0041%2013.733L17.2941%208.44301C17.4854%208.27918%2017.7315%208.19358%2017.9831%208.2033C18.2348%208.21302%2018.4736%208.31735%2018.6517%208.49544C18.8297%208.67354%2018.9341%208.91228%2018.9438%209.16395C18.9535%209.41563%2018.8679%209.66171%2018.7041%209.85301L12.7041%2015.853C12.5178%2016.0378%2012.2664%2016.1419%2012.0041%2016.143Z%22%20fill%3D%22%23111111%22/%3E%0A%3C/svg%3E');
                        position: absolute;
                        top: 50%;
                        right: 1.5rem;
                        transform: translateY(-50%);
                        transition: transform 0.3s ease;
                      }
                    }
                    &.active {
                      > a{
                        border-bottom: 2px solid #11111199;
                        &::after {
                          transform: translateY(-50%) rotate(180deg);
                        }
                      }
                      .level-4-menu {
                        max-height: 1000px;
                        opacity: 1;
                        transform: scaleY(1);
                        
                        .level-4-menu-container > li {
                          opacity: 1;
                          transform: translateY(0);
                        }
                      }
                    }
                    .level-4-menu{
                      max-height: 0;
                      opacity: 0;
                      overflow: hidden;
                      transform: scaleY(0);
                      transform-origin: top;
                      transition: max-height 0.4s ease-in-out, opacity 0.3s ease-in-out, transform 0.3s ease-in-out;
                                              .level-4-menu-container{
                          padding: 0;
                          list-style: none;
                          > li{
                            opacity: 0;
                            transform: translateY(-10px);
                            transition: opacity 0.3s ease-in-out, transform 0.3s ease-in-out;
                            
                            // Stagger animation for each item
                            @for $i from 1 through 10 {
                              &:nth-child(#{$i}) {
                                transition-delay: #{$i * 0.05}s;
                              }
                            }
                            
                            > a{
                              padding: 1rem 1.5rem;
                            }
                          }
                      }
                    }
                  }
                }
              }
            }
          }
        }
      }
    }
    li.has-image-link, li.menu-cover-image{
      display: none;
    }
  }
  
  // AAA: Mobile-specific accessibility enhancements
  
  
  // Focus trap indicator
  .focus-trap-start,
  .focus-trap-end {
    position: absolute;
    left: -9999px;
    width: 1px;
    height: 1px;
    opacity: 0;
  }
  
  // AAA: High contrast mode support for mobile
  @media (prefers-contrast: high) {
    .header__toggle:focus-visible,
    .header__mobile-close:focus-visible,
    .header__menu-link:focus-visible,
    .header__search-submit-btn:focus-visible {
      outline: 4px solid;
      outline-color: Highlight;
      background-color: ButtonFace;
    }
    
    .mega-menu-wrapper a:focus-visible {
      outline: 4px solid;
      outline-color: Highlight;
      background-color: ButtonFace;
    }
  }
  
  // AAA: Reduced motion support for mobile
  @media (prefers-reduced-motion: reduce) {
    .navbar-collapse,
    .mega-menu-wrapper,
    .level-3-menu,
    .level-4-menu,
    .header__toggle,
    .header__mobile-close {
      transition: none;
      animation: none;
    }
    
    .header__toggle:active,
    .header__mobile-close:active {
      transform: none;
    }
  }
}
}

@keyframes headerSlideDown {
  0% {
    transform: translateY(-100%);
  }
  100% {
    transform: translateY(0);
  }
}

@keyframes headerSlideUp {
  0% {
    transform: translateY(0);
  }
  100% {
    transform: translateY(-100%);
  }
}




// Search Overlay Styles
.search-overlay {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background-color: rgba(0, 0, 0, 0.8);
  backdrop-filter: blur(8px);
  z-index: 9999;
  display: flex;
  align-items: flex-start;
  justify-content: center;
  padding: rem.convert(100px) rem.convert(24px) rem.convert(24px);
  
  // Animation states
  opacity: 0;
  visibility: hidden;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  
  &.show {
    opacity: 1;
    visibility: visible;
    
    .search-overlay-content {
      transform: translateY(0) scale(1);
      opacity: 1;
    }
  }
  
  @include media-breakpoint-down(lg) {
    padding: rem.convert(80px) rem.convert(16px) rem.convert(16px);
  }
}

.search-overlay-content {
  background: var(--white);
  border-radius: rem.convert(16px);
  box-shadow: 0 20px 40px rgba(0, 0, 0, 0.15);
  width: 100%;
  max-width: rem.convert(600px);
  padding: rem.convert(32px);
  
  // Animation initial state
  transform: translateY(-30px) scale(0.95);
  opacity: 0;
  transition: all 0.4s cubic-bezier(0.34, 1.56, 0.64, 1);
  
  @include media-breakpoint-down(lg) {
    padding: rem.convert(24px);
    max-width: 100%;
  }
}

.search-overlay-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: rem.convert(24px);
}

.search-overlay-title {
  font-family: "Sculpin", "Segoe UI", Arial, sans-serif;
  font-weight: $bold;
  @include rem.convert(font-size, 24px);
  line-height: 1.2;
  color: var(--black);
  margin: 0;
  
  @include media-breakpoint-down(lg) {
    @include rem.convert(font-size, 20px);
  }
}

.search-overlay-close {
  background: none;
  border: none;
  padding: rem.convert(8px);
    cursor: pointer;
  border-radius: rem.convert(8px);
  transition: background-color 0.2s ease;
  display: flex;
  align-items: center;
  justify-content: center;
  
  &:hover,
  &:focus {
    background-color: rgba(var(--black-rgb), 0.1);
    outline: none;
  }
  
  &:focus-visible {
    outline: 2px solid var(--green);
    outline-offset: 2px;
  }
  
  svg {
    width: rem.convert(24px);
    height: rem.convert(24px);
    color: var(--black);
  }
}

.search-form {
  margin-bottom: rem.convert(32px);
}

.search-input-group {
    position: relative;
    display: flex;
  align-items: center;
  background: var(--white);
  border: 2px solid #e1e5e9;
  border-radius: rem.convert(50px);
  overflow: hidden;
  transition: border-color 0.2s ease, box-shadow 0.2s ease;
  
  &:focus-within {
    border-color: var(--green);
    box-shadow: 0 0 0 4px rgba(var(--green-rgb), 0.1);
  }
}

.search-input {
  flex: 1;
  border: none;
  outline: none;
  background: transparent;
  padding: rem.convert(16px) rem.convert(24px);
  font-family: "Sculpin", "Segoe UI", Arial, sans-serif;
  font-weight: 400;
  @include rem.convert(font-size, 16px);
  line-height: 1.5;
  color: var(--black);
  
  &::placeholder {
    color: rgba(var(--black-rgb), 0.5);
  }
  
  &::-webkit-search-cancel-button {
    -webkit-appearance: none;
    appearance: none;
  }
  
  @include media-breakpoint-down(lg) {
    padding: rem.convert(14px) rem.convert(20px);
    @include rem.convert(font-size, 14px);
  }
}

.search-submit-btn {
  background: var(--green);
  border: none;
  padding: rem.convert(20px) rem.convert(24px);
  cursor: pointer;
  display: flex;
  align-items: center;
  justify-content: center;
  transition: background-color 0.2s ease;
  
  &:hover,
  &:focus {
    background: darken(#4CAF50, 10%);
    outline: none;
  }
  
  &:focus-visible {
    outline: 2px solid var(--black);
    outline-offset: 2px;
  }
  
  svg {
    width: rem.convert(20px);
    height: rem.convert(20px);
    color: var(--white);
  }
  
  @include media-breakpoint-down(lg) {
    padding: rem.convert(14px) rem.convert(20px);
    
    svg {
      width: rem.convert(18px);
      height: rem.convert(18px);
    }
  }
}

.search-suggestions {
  margin-top: rem.convert(24px);
}

.search-suggestions-title {
  font-family: "Sculpin", "Segoe UI", Arial, sans-serif;
  font-weight: $semibold;
  @include rem.convert(font-size, 14px);
  line-height: 1.2;
  color: rgba(var(--black-rgb), 0.7);
  margin: 0 0 rem.convert(12px) 0;
  text-transform: uppercase;
  letter-spacing: 0.5px;
}

.search-suggestions-list {
  display: flex;
  flex-wrap: wrap;
  gap: rem.convert(8px);
}

.search-suggestion-item {
  background: rgba(var(--green-rgb), 0.1);
  border: 1px solid rgba(var(--green-rgb), 0.2);
  border-radius: rem.convert(20px);
  padding: rem.convert(8px) rem.convert(16px);
  font-family: "Sculpin", "Segoe UI", Arial, sans-serif;
  font-weight: 500;
  @include rem.convert(font-size, 13px);
  line-height: 1.2;
  color: var(--black);
  cursor: pointer;
  transition: all 0.2s ease;
  
  &:hover,
  &:focus {
    background: var(--green);
    border-color: var(--green);
    color: var(--white);
    outline: none;
    transform: translateY(-1px);
  }
  
  &:focus-visible {
    outline: 2px solid var(--black);
    outline-offset: 2px;
  }
  
  @include media-breakpoint-down(lg) {
    @include rem.convert(font-size, 12px);
    padding: rem.convert(6px) rem.convert(12px);
  }
}

// Animation for search suggestions
.search-overlay.show .search-suggestion-item {
  animation: slideInUp 0.3s ease-out both;
  
  @for $i from 1 through 6 {
    &:nth-child(#{$i}) {
      animation-delay: #{$i * 0.05}s;
    }
  }
}

@keyframes slideInUp {
  from {
    opacity: 0;
    transform: translateY(10px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

// Prevent body scroll when search is open
body.search-open {
  overflow: hidden;
}

@keyframes slideInFromTop {
  from { transform: translateY(-20px); opacity: 0; }
  to { transform: translateY(0); opacity: 1; }
}

// AAA Accessibility: Reduced Motion Support
@media (prefers-reduced-motion: reduce) {
  .mega-menu-wrapper,
  .level-3-menu,
  .level-4-menu,
  .header__menu-icon {
    transition: none;
    animation: none;
  }
  
  .mega-menu-wrapper.show .mega-menu-inner {
    animation: none;
  }
}

// AAA Accessibility: High Contrast Mode Support
@media (prefers-contrast: high) {
  .header__menu-link:focus-visible,
  .mega-menu a:focus-visible {
    outline: 4px solid;
    outline-color: Highlight;
    box-shadow: none;
  }
}

// Screen Reader Only Class for Announcements
.sr-only {
  position: absolute;
  width: 1px;
  height: 1px;
  padding: 0;
  margin: -1px;
  overflow: hidden;
  clip: rect(0, 0, 0, 0);
  white-space: nowrap;
  border: 0;
}